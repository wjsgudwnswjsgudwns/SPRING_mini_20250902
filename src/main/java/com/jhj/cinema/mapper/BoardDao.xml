<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
    
    <mapper namespace="com.jhj.cinema.dao.BoardDao">
    
    <!-- 특정유저 정보 -->
   	<!-- board:member 1:1 관계 매핑 -->
   	<resultMap type="com.jhj.cinema.dto.BoardDto" id="boardWithMember">
   		<id property="bnum" column="bnum"/> <!-- board 테이블 기본키 세팅 -->
   		<result property="btitle" column="btitle"/> <!-- board 테이블 나머지 필드 세팅 -->
   		<result property="bcontent" column="bcontent"/> <!-- board 테이블 나머지 필드 세팅 -->
   		<result property="memberid" column="memberid"/> <!-- board 테이블 나머지 필드 세팅 -->
   		<result property="bhit" column="bhit"/> <!-- board 테이블 나머지 필드 세팅 -->
   		<result property="bdate" column="bdate"/> <!-- board 테이블 나머지 필드 세팅 -->
   		<result property="rnum" column="rnum"/> <!-- board 테이블 나머지 필드 세팅 -->
   		
   		<association property="memberDto" javaType="com.jhj.cinema.dto.MemberDto">
   			<id property="memberid" column="memberid"/>
   			<result property="memberpw" column="memberpw"/>
   			<result property="membername" column="membername"/>
   			<result property="memberemail" column="memberemail"/>
   			<result property="memberphone" column="memberphone"/>
   		</association>
   	</resultMap>
   	
   	<!-- 게시판 보기 -->
   	<select id="boardlistDao" resultMap="boardWithMember">
   		SELECT b.bnum,b.btitle,b.bcontent,b.memberid,m.membername,b.bhit,b.bdate  
   		FROM cinemaboard b
   		INNER JOIN cinemamember m 
   		ON b.memberid = m.memberid  
   		ORDER BY b.bnum DESC
   	</select>
   	
   	<!-- 글쓰기 -->
   	<insert id="contentWriteDao">
   		INSERT INTO cinemaboard(bnum,btitle,memberid,bcontent,bhit) VALUES (BOARD_SEQ.nextval,#{param1},#{param2},#{param3},0)
   	</insert>
   	
   	<!-- 조회수 -->
   	<update id="bhitDao">
   		UPDATE cinemaboard SET bhit=bhit+1 WHERE bnum=#{param1}
   	</update>
    
    <!-- 게시글 보기 -->
    <select id="contentViewDao" resultType="com.jhj.cinema.dao.BoardDao">
    	SELECT * FROM cinemaboard WHERE bnum=#{param1}
    </select>
    
    <!-- 글 삭제 -->
   	<delete id="boardDeleteDao">
   		DELETE FROM boardtbl WHERE bnum=#{param1}
   	</delete>
    
    <!-- 글 수정 -->
    <update id="contentModifyDao">
    	UPDATE cinemaboard SET btitle=#{param1},memberid=#{param2},bcontent=#{param3} WHERE bnum=#{param4}
    </update>
    
    </mapper>